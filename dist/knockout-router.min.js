!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("knockout")):"function"==typeof define&&define.amd?define(["exports","knockout"],e):e(t.KnockoutRouter=t.KnockoutRouter||{},t.ko)}(this,function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function n(t,e){return e={exports:{}},t(e,e.exports),e.exports}function o(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function i(t,e){if(e)for(var r in e)e.hasOwnProperty(r)&&!t.hasOwnProperty(r)&&(t[r]=e[r]);return t}function a(t,e){e=String(e);var r=e.length;return 0===r||t.substr(0,r)===e}function u(t){return B(t.$parents,function(t){return t instanceof I})}function s(t){return t.split("#")[0].split("?")[0]}function c(t){var e=t.pathname,r=t.search,n=t.hash;return e+r+(n||"")}function l(t,r,n){return void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=null),(a(r,"~/")?t+r.substr(1):r)+(n?"?"+H(e.toJS(n)):"")}function f(t){return t=t||window.event,null===t.which?t.button:t.which}function p(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t&&0===t.indexOf(e)}function d(t,e){var r=t.getAttribute("params");return r?z.parseBindingsString(r,e,t,J):{}}function h(){}function y(t,r,n){var o=u(e.contextFor(t)),i=o&&o.rootUrl||"",a={},s=e.pureComputed(function(){return l(i,r.get("path"),r.get("query"))});"A"===t.tagName.toLocaleUpperCase()?a.attr={href:s}:a.click=function(e,r){var n=1!==f(r),o=t.hasAttribute("target"),i="external"===t.getAttribute("rel"),a=r.metaKey||r.ctrlKey||r.shiftKey;if(n||o||i||a)return!0;var u=v(s());return u&&(r.preventDefault(),r.stopImmediatePropagation()),!u};var c=r.get("activePathCss");if(c){var p=e.pureComputed(function(){return l(i,r.get("path"))});a.css=(d={},d[c]=e.pureComputed(function(){return p()===Z()}),d)}e.tasks.schedule(function(){return e.applyBindingsToNode(t,a,n)});var d}function v(t,e){void 0===e&&(e=!1);var r=++rt,n=et.map(function(e){return e.dispatch(t)}).filter(function(t){return!!t}),o=!!B(et,function(t){return!!t.route});o&&"undefined"!=typeof history&&(e?history.replaceState(null,null,t):history.pushState(null,null,t));var i=function(){r===rt&&(et.forEach(function(t){t.navReqNumber=rt,t.navigate()}),o&&Z(s(t)))};return 0==n.length?i():Promise.all(n).then(i),o}function g(t){ot||t.defaultPrevented||v(c(location),!0)&&t.preventDefault()}function m(t){for(var e=t.target;e&&"A"!==e.nodeName;)e=e.parentNode;if(e&&"A"===e.nodeName){var r=1!==f(t),n=t.metaKey||t.ctrlKey||t.shiftKey,o=e.hasAttribute("download"),i=e.hasAttribute("target"),a="external"===e.getAttribute("rel"),u=~(e.getAttribute("href")||"").indexOf("mailto:"),s=!p(e.href),l="#"===e.getAttribute("href");s||r||o||l||u||a||n||i||v(c(e))&&t.preventDefault()}}function b(){}var x=n(function(t,e){var r=function(){for(var t=new Array(256),e=0;e<256;++e)t[e]="%"+((e<16?"0":"")+e.toString(16)).toUpperCase();return t}();e.arrayToObject=function(t,e){for(var r=e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)"undefined"!=typeof t[n]&&(r[n]=t[n]);return r},e.merge=function(t,r,n){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];t[r]=!0}return t}if("object"!=typeof t)return[t].concat(r);var o=t;return Array.isArray(t)&&!Array.isArray(r)&&(o=e.arrayToObject(t,n)),Object.keys(r).reduce(function(t,o){var i=r[o];return Object.prototype.hasOwnProperty.call(t,o)?t[o]=e.merge(t[o],i,n):t[o]=i,t},o)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),n="",o=0;o<e.length;++o){var i=e.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?n+=e.charAt(o):i<128?n+=r[i]:i<2048?n+=r[192|i>>6]+r[128|63&i]:i<55296||i>=57344?n+=r[224|i>>12]+r[128|i>>6&63]+r[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(o)),n+=r[240|i>>18]+r[128|i>>12&63]+r[128|i>>6&63]+r[128|63&i])}return n},e.compact=function(t,r){if("object"!=typeof t||null===t)return t;var n=r||[],o=n.indexOf(t);if(o!==-1)return n[o];if(n.push(t),Array.isArray(t)){for(var i=[],a=0;a<t.length;++a)t[a]&&"object"==typeof t[a]?i.push(e.compact(t[a],n)):"undefined"!=typeof t[a]&&i.push(t[a]);return i}for(var u=Object.keys(t),s=0;s<u.length;++s){var c=u[s];t[c]=e.compact(t[c],n)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null!==t&&"undefined"!=typeof t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}}),w=r(x),O=x.isBuffer,j=x.isRegExp,A=x.compact,N=x.encode,E=x.decode,P=x.merge,k=x.arrayToObject,R=Object.freeze({default:w,isBuffer:O,isRegExp:j,compact:A,encode:N,decode:E,merge:P,arrayToObject:k}),L=n(function(t){var e=r(R),n={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},o={delimiter:"&",strictNullHandling:!1,skipNulls:!1,encode:!0,encoder:e.encode},i=function t(r,n,o,i,a,u,s,c,l){var f=r;if("function"==typeof s)f=s(n,f);else if(f instanceof Date)f=f.toISOString();else if(null===f){if(i)return u?u(n):n;f=""}if("string"==typeof f||"number"==typeof f||"boolean"==typeof f||e.isBuffer(f))return u?[u(n)+"="+u(f)]:[n+"="+String(f)];var p=[];if("undefined"==typeof f)return p;var d;if(Array.isArray(s))d=s;else{var h=Object.keys(f);d=c?h.sort(c):h}for(var y=0;y<d.length;++y){var v=d[y];a&&null===f[v]||(p=Array.isArray(f)?p.concat(t(f[v],o(n,v),o,i,a,u,s,c,l)):p.concat(t(f[v],n+(l?"."+v:"["+v+"]"),o,i,a,u,s,c,l)))}return p};t.exports=function(t,e){var r,a,u=t,s=e||{},c="undefined"==typeof s.delimiter?o.delimiter:s.delimiter,l="boolean"==typeof s.strictNullHandling?s.strictNullHandling:o.strictNullHandling,f="boolean"==typeof s.skipNulls?s.skipNulls:o.skipNulls,p="boolean"==typeof s.encode?s.encode:o.encode,d=p?"function"==typeof s.encoder?s.encoder:o.encoder:null,h="function"==typeof s.sort?s.sort:null,y="undefined"!=typeof s.allowDots&&s.allowDots;if(null!==s.encoder&&void 0!==s.encoder&&"function"!=typeof s.encoder)throw new TypeError("Encoder has to be a function.");"function"==typeof s.filter?(a=s.filter,u=a("",u)):Array.isArray(s.filter)&&(r=a=s.filter);var v=[];if("object"!=typeof u||null===u)return"";var g;g=s.arrayFormat in n?s.arrayFormat:"indices"in s?s.indices?"indices":"repeat":"indices";var m=n[g];r||(r=Object.keys(u)),h&&r.sort(h);for(var b=0;b<r.length;++b){var x=r[b];f&&null===u[x]||(v=v.concat(i(u[x],x,m,l,f,d,a,h,y)))}return v.join(c)}}),S=r(L),C=Object.freeze({default:S}),T=n(function(t){var e=r(R),n=Object.prototype.hasOwnProperty,o={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,decoder:e.decode},i=function(t,e){for(var r={},o=t.split(e.delimiter,e.parameterLimit===1/0?void 0:e.parameterLimit),i=0;i<o.length;++i){var a,u,s=o[i],c=s.indexOf("]=")===-1?s.indexOf("="):s.indexOf("]=")+1;c===-1?(a=e.decoder(s),u=e.strictNullHandling?null:""):(a=e.decoder(s.slice(0,c)),u=e.decoder(s.slice(c+1))),n.call(r,a)?r[a]=[].concat(r[a]).concat(u):r[a]=u}return r},a=function t(e,r,n){if(!e.length)return r;var o,i=e.shift();if("[]"===i)o=[],o=o.concat(t(e,r,n));else{o=n.plainObjects?Object.create(null):{};var a="["===i[0]&&"]"===i[i.length-1]?i.slice(1,i.length-1):i,u=parseInt(a,10);!isNaN(u)&&i!==a&&String(u)===a&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[],o[u]=t(e,r,n)):o[a]=t(e,r,n)}return o},u=function(t,e,r){if(t){var o=r.allowDots?t.replace(/\.([^\.\[]+)/g,"[$1]"):t,i=/^([^\[\]]*)/,u=/(\[[^\[\]]*\])/g,s=i.exec(o),c=[];if(s[1]){if(!r.plainObjects&&n.call(Object.prototype,s[1])&&!r.allowPrototypes)return;c.push(s[1])}for(var l=0;null!==(s=u.exec(o))&&l<r.depth;)l+=1,(r.plainObjects||!n.call(Object.prototype,s[1].replace(/\[|\]/g,""))||r.allowPrototypes)&&c.push(s[1]);return s&&c.push("["+o.slice(s.index)+"]"),a(c,e,r)}};t.exports=function(t,r){var n=r||{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.delimiter="string"==typeof n.delimiter||e.isRegExp(n.delimiter)?n.delimiter:o.delimiter,n.depth="number"==typeof n.depth?n.depth:o.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:o.arrayLimit,n.parseArrays=n.parseArrays!==!1,n.decoder="function"==typeof n.decoder?n.decoder:o.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:o.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:o.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:o.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:o.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:o.strictNullHandling,""===t||null===t||"undefined"==typeof t)return n.plainObjects?Object.create(null):{};for(var a="string"==typeof t?i(t,n):t,s=n.plainObjects?Object.create(null):{},c=Object.keys(a),l=0;l<c.length;++l){var f=c[l],p=u(f,a[f],n);s=e.merge(s,p,n)}return e.compact(s)}}),U=r(T),D=Object.freeze({default:U}),F=n(function(t){var e=r(C),n=r(D);t.exports={stringify:e,parse:n}});r(F);var H=F.stringify,$=F.parse,B=e.utils.arrayFirst,K=e.utils.objectForEach,q=e.utils.extend,I=function(){function t(){}return t}(),z=new e.bindingProvider,J={bindingParams:!0},M=function(){function t(t,r){this.params={},this.state=e.observable(),this.route=e.observable(),this.url=e.observable(),this.update(t),i(this,r)}return t.prototype.update=function(t){var r=this,n=t.params,o=t.state,i=t.route,a=t.url;K(n,function(t,n){var o=r.params[t];o?o(n):r.params[t]=e.observable(n)}),K(this.params,function(t,e){n.hasOwnProperty(t)||e(null)}),this.state(o),this.route(i),this.url(a)},t}(),_=n(function(t){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}}),V=r(_),G=Object.freeze({default:V}),Q=n(function(t){function e(t){for(var e,r=[],n=0,o=0,i="";null!=(e=g.exec(t));){var a=e[0],u=e[1],c=e.index;if(i+=t.slice(o,c),o=c+a.length,u)i+=u[1];else{var l=t[o],f=e[2],p=e[3],d=e[4],h=e[5],y=e[6],v=e[7];i&&(r.push(i),i="");var m=null!=f&&null!=l&&l!==f,b="+"===y||"*"===y,x="?"===y||"*"===y,w=e[2]||"/",O=d||h||(v?".*":"[^"+w+"]+?");r.push({name:p||n++,prefix:f||"",delimiter:w,optional:x,repeat:b,partial:m,asterisk:!!v,pattern:s(O)})}}return o<t.length&&(i+=t.substr(o)),i&&r.push(i),r}function n(t){return a(e(t))}function o(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function i(t){return encodeURI(t).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function a(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,n){for(var a="",u=r||{},s=n||{},c=s.pretty?o:encodeURIComponent,l=0;l<t.length;l++){var f=t[l];if("string"!=typeof f){var p,d=u[f.name];if(null==d){if(f.optional){f.partial&&(a+=f.prefix);continue}throw new TypeError('Expected "'+f.name+'" to be defined')}if(v(d)){if(!f.repeat)throw new TypeError('Expected "'+f.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(f.optional)continue;throw new TypeError('Expected "'+f.name+'" to not be empty')}for(var h=0;h<d.length;h++){if(p=c(d[h]),!e[l].test(p))throw new TypeError('Expected all "'+f.name+'" to match "'+f.pattern+'", but received `'+JSON.stringify(p)+"`");a+=(0===h?f.prefix:f.delimiter)+p}}else{if(p=f.asterisk?i(d):c(d),!e[l].test(p))throw new TypeError('Expected "'+f.name+'" to match "'+f.pattern+'", but received "'+p+'"');a+=f.prefix+p}}else a+=f}return a}}function u(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function s(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function c(t,e){return t.keys=e,t}function l(t){return t.sensitive?"":"i"}function f(t,e){var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return c(t,e)}function p(t,e,r){for(var n=[],o=0;o<t.length;o++)n.push(y(t[o],e,r).source);var i=new RegExp("(?:"+n.join("|")+")",l(r));return c(i,e)}function d(t,r,n){for(var o=e(t),i=h(o,n),a=0;a<o.length;a++)"string"!=typeof o[a]&&r.push(o[a]);return c(i,r)}function h(t,e){e=e||{};for(var r=e.strict,n=e.end!==!1,o="",i=t[t.length-1],a="string"==typeof i&&/\/$/.test(i),s=0;s<t.length;s++){var c=t[s];if("string"==typeof c)o+=u(c);else{var f=u(c.prefix),p="(?:"+c.pattern+")";c.repeat&&(p+="(?:"+f+p+")*"),p=c.optional?c.partial?f+"("+p+")?":"(?:"+f+"("+p+"))?":f+"("+p+")",o+=p}}return r||(o=(a?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=n?"$":r&&a?"":"(?=\\/|$)",new RegExp("^"+o,l(e))}function y(t,e,r){return e=e||[],v(e)?r||(r={}):(r=e,e=[]),t instanceof RegExp?f(t,e):v(t)?p(t,e,r):d(t,e,r)}var v=r(G);t.exports=y,t.exports.parse=e,t.exports.compile=n,t.exports.tokensToFunction=a,t.exports.tokensToRegExp=h;var g=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")}),W=r(Q),X=W,Y=function(){function t(t,r,n,o){var i=this;this.component=e.components.getComponentNameForNode(t),this.restParams=d(t,r);var a=this.restParams,u=a.route,s=a.action;delete this.restParams.route,delete this.restParams.action,u=u||t.getAttribute("route"),s=s||t.getAttribute("action"),this.route=n+u,this.action=h,"function"==typeof s?this.action=s:"string"==typeof s&&(o.hasOwnProperty(s)?this.action=o[s]:e.components.defaultLoader.getConfig(this.component,function(t){t.hasOwnProperty(s)&&(i.action=t[s])})),this.re=X(this.route),this.keys=this.re.keys.map(function(t){return t.name})}return t.prototype.dispatch=function(t){var e=t.split("?"),r=e[0],n=e[1],o=this.re.exec(r);if(!o)return!1;for(var i={},a=1;a<o.length;++a)i[this.keys[a-1]]=o[a];return q(i,$(n)),this.context={params:i,state:null,route:this.route,url:o[0]},!0},t}();e.bindingHandlers.path={init:function(t,e,r,n,o){y.call(this,t,r,o)}};var Z=e.observable(location.pathname),tt="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",et=[],rt=0,nt=function(t){function r(r,n,o){var a=this,s=o.rootUrl,l=o.routePrefix,f=o.onNavStart,p=o.onNavFinish,d=o.actions;t.call(this),this.route=null,this.routes=[],this.binding=e.observable(),et.push(this),1===et.length&&(addEventListener(tt,m,!1),addEventListener("popstate",g,!1)),s=s||r.getAttribute("rootUrl"),l=l||r.getAttribute("routePrefix");var h=e.contextFor(r),y=u(h);if(y){if("string"==typeof s)throw new Error("Only top-level router can specify 'rootUrl'");this.rootUrl=y.rootUrl,this.routePrefix=y.routePrefix+(l||""),this.actions=i(d||{},y.actions),this.navReqNumber=y.navReqNumber}else this.rootUrl=s||"",this.routePrefix=this.rootUrl+(l||""),this.actions=d||{},this.navReqNumber=rt;this.onNavStart=f||b,this.onNavFinish=p||b,this.routes=n.map(function(t){return new Y(t,h,a.routePrefix,a.actions)}),this.dispatchAndNavigate(c(location))}return o(r,t),r.prototype.dispose=function(){et.splice(et.indexOf(this),1),0===et.length&&(removeEventListener(tt,m,!1),removeEventListener("popstate",g,!1))},r.prototype.dispatch=function(t){if(this.onNavStart(),this.route=B(this.routes,function(e){return e.dispatch(t)}),this.route){var e=this.binding(),r=this.route,n=r.component,o=r.context,i=r.action;return e&&e.name===n&&(o.state=e.params.state()),i(o)}},r.prototype.navigate=function(){if(this.navReqNumber===rt){if(!this.route)return this.binding(null),void this.onNavFinish();var t=this.route,r=t.component,n=t.context,o=t.restParams,i=this.binding();i&&i.name===r?i.params.update(n):(this.binding({name:r,params:new M(n,o)}),e.tasks.runEarly()),this.route=null,this.onNavFinish()}},r.prototype.dispatchAndNavigate=function(t){var e=this,r=this.dispatch(t);r?r.then(function(){e.navigate()}):this.navigate()},r}(I),ot=!0;addEventListener("load",function(){setTimeout(function(){ot=!1})}),e.components.register("knockout-router",{synchronous:!0,viewModel:{createViewModel:function(t,e){var r=e.element,n=e.templateNodes;return new nt(r,n.filter(function(t){return 1===t.nodeType}),t)}},template:'<div data-bind="if: binding"><div data-bind="component: binding"></div></div>'}),t.navigate=v,Object.defineProperty(t,"__esModule",{value:!0})});