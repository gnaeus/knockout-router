!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("knockout")):"function"==typeof define&&define.amd?define(["exports","knockout"],e):e(t.KnockoutRouter=t.KnockoutRouter||{},t.ko)}(this,function(t,e){"use strict";function r(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function n(t){return g(t.$parents,function(t){return t instanceof x})}function o(t){var e=t.pathname,r=t.search,n=t.hash;return e+r+(n||"")}function i(t){return t=t||window.event,null===t.which?t.button:t.which}function a(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t&&0===t.indexOf(e)}function c(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function u(t,e){return e={exports:{}},t(e,e.exports),e.exports}function s(){}function l(t){t=t.split("#")[0].split("?")[0],W(t)}function p(t,r,n){return void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=null),(r.startsWith("~/")?t+r.substr(1):r)+(n?"?"+J(e.toJS(n)):"")}function f(t,r,o){var a=n(e.contextFor(t)),c=a&&a.rootUrl||"",u=e.pureComputed(function(){return p(c,r.get("path"),r.get("query"))}),s={};"A"===t.tagName.toLocaleUpperCase()?s.attr={href:u}:s.click=function(e,r){var n=1!==i(r),o=t.hasAttribute("target"),a="external"===t.getAttribute("rel"),c=r.metaKey||r.ctrlKey||r.shiftKey;if(n||o||a||c)return!0;var s=d(u());return s&&(r.preventDefault(),r.stopImmediatePropagation()),!s};var l=r.get("activePathCss");l&&(s.css=(f={},f[l]=e.pureComputed(function(){return u()===W()}),f)),e.tasks.schedule(function(){return e.applyBindingsToNode(t,s,o)});var f}function d(t,e){void 0===e&&(e=!1);var r=Q.map(function(e){return e.dispatch(t)}).filter(function(t){return!!t}),n=!!g(Q,function(t){return!!t.route});n&&"undefined"!=typeof history&&(e?history.replaceState(null,null,t):history.pushState(null,null,t));var o=function(){Q.forEach(function(t){t.navigate()}),n&&l(t)};return 0==r.length?o():Promise.all(r).then(o),n}function h(t){t.defaultPrevented||d(o(location),!0)&&t.preventDefault()}function y(t){for(var e=t.target;e&&"A"!==e.nodeName;)e=e.parentNode;if(e&&"A"===e.nodeName){var r=1!==i(t),n=t.metaKey||t.ctrlKey||t.shiftKey,c=e.hasAttribute("download"),u=e.hasAttribute("target"),s="external"===e.getAttribute("rel"),l=~(e.getAttribute("href")||"").indexOf("mailto:"),p=!a(e.href),f="#"===e.getAttribute("href");p||r||c||f||l||s||n||u||d(o(e))&&t.preventDefault()}}function v(){}var g=(Function.prototype.call.bind(Array.prototype.slice),e.utils.arrayFirst),m=e.utils.objectForEach,b=e.utils.extend,x=function(){function t(){}return t}(),w=(new e.bindingProvider,function(){function t(t){this.params={},this.state=e.observable(),this.route=e.observable(),this.url=e.observable(),this.update(t)}return t.prototype.update=function(t){var r=this,n=t.params,o=t.state,i=t.route,a=t.url;m(n,function(t,n){var o=r.params[t];o?o(n):r.params[t]=e.observable(n)}),m(this.params,function(t,e){n.hasOwnProperty(t)||e(null)}),this.state(o),this.route(i),this.url(a)},t}()),O=u(function(t){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}}),j=c(O),A=Object.freeze({default:j}),N=u(function(t){function e(t){for(var e,r=[],n=0,o=0,i="";null!=(e=g.exec(t));){var a=e[0],c=e[1],s=e.index;if(i+=t.slice(o,s),o=s+a.length,c)i+=c[1];else{var l=t[o],p=e[2],f=e[3],d=e[4],h=e[5],y=e[6],v=e[7];i&&(r.push(i),i="");var m=null!=p&&null!=l&&l!==p,b="+"===y||"*"===y,x="?"===y||"*"===y,w=e[2]||"/",O=d||h||(v?".*":"[^"+w+"]+?");r.push({name:f||n++,prefix:p||"",delimiter:w,optional:x,repeat:b,partial:m,asterisk:!!v,pattern:u(O)})}}return o<t.length&&(i+=t.substr(o)),i&&r.push(i),r}function r(t){return i(e(t))}function n(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function o(t){return encodeURI(t).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function i(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,i){for(var a="",c=r||{},u=i||{},s=u.pretty?n:encodeURIComponent,l=0;l<t.length;l++){var p=t[l];if("string"!=typeof p){var f,d=c[p.name];if(null==d){if(p.optional){p.partial&&(a+=p.prefix);continue}throw new TypeError('Expected "'+p.name+'" to be defined')}if(v(d)){if(!p.repeat)throw new TypeError('Expected "'+p.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(p.optional)continue;throw new TypeError('Expected "'+p.name+'" to not be empty')}for(var h=0;h<d.length;h++){if(f=s(d[h]),!e[l].test(f))throw new TypeError('Expected all "'+p.name+'" to match "'+p.pattern+'", but received `'+JSON.stringify(f)+"`");a+=(0===h?p.prefix:p.delimiter)+f}}else{if(f=p.asterisk?o(d):s(d),!e[l].test(f))throw new TypeError('Expected "'+p.name+'" to match "'+p.pattern+'", but received "'+f+'"');a+=p.prefix+f}}else a+=p}return a}}function a(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function u(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function s(t,e){return t.keys=e,t}function l(t){return t.sensitive?"":"i"}function p(t,e){var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return s(t,e)}function f(t,e,r){for(var n=[],o=0;o<t.length;o++)n.push(y(t[o],e,r).source);var i=new RegExp("(?:"+n.join("|")+")",l(r));return s(i,e)}function d(t,r,n){for(var o=e(t),i=h(o,n),a=0;a<o.length;a++)"string"!=typeof o[a]&&r.push(o[a]);return s(i,r)}function h(t,e){e=e||{};for(var r=e.strict,n=e.end!==!1,o="",i=t[t.length-1],c="string"==typeof i&&/\/$/.test(i),u=0;u<t.length;u++){var s=t[u];if("string"==typeof s)o+=a(s);else{var p=a(s.prefix),f="(?:"+s.pattern+")";s.repeat&&(f+="(?:"+p+f+")*"),f=s.optional?s.partial?p+"("+f+")?":"(?:"+p+"("+f+"))?":p+"("+f+")",o+=f}}return r||(o=(c?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=n?"$":r&&c?"":"(?=\\/|$)",new RegExp("^"+o,l(e))}function y(t,e,r){return e=e||[],v(e)?r||(r={}):(r=e,e=[]),t instanceof RegExp?p(t,e):v(t)?f(t,e,r):d(t,e,r)}var v=c(A);t.exports=y,t.exports.parse=e,t.exports.compile=r,t.exports.tokensToFunction=i,t.exports.tokensToRegExp=h;var g=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")}),k=c(N),E=u(function(t,e){var r=function(){for(var t=new Array(256),e=0;e<256;++e)t[e]="%"+((e<16?"0":"")+e.toString(16)).toUpperCase();return t}();e.arrayToObject=function(t,e){for(var r=e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)"undefined"!=typeof t[n]&&(r[n]=t[n]);return r},e.merge=function(t,r,n){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];t[r]=!0}return t}if("object"!=typeof t)return[t].concat(r);var o=t;return Array.isArray(t)&&!Array.isArray(r)&&(o=e.arrayToObject(t,n)),Object.keys(r).reduce(function(t,o){var i=r[o];return Object.prototype.hasOwnProperty.call(t,o)?t[o]=e.merge(t[o],i,n):t[o]=i,t},o)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),n="",o=0;o<e.length;++o){var i=e.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?n+=e.charAt(o):i<128?n+=r[i]:i<2048?n+=r[192|i>>6]+r[128|63&i]:i<55296||i>=57344?n+=r[224|i>>12]+r[128|i>>6&63]+r[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(o)),n+=r[240|i>>18]+r[128|i>>12&63]+r[128|i>>6&63]+r[128|63&i])}return n},e.compact=function(t,r){if("object"!=typeof t||null===t)return t;var n=r||[],o=n.indexOf(t);if(o!==-1)return n[o];if(n.push(t),Array.isArray(t)){for(var i=[],a=0;a<t.length;++a)t[a]&&"object"==typeof t[a]?i.push(e.compact(t[a],n)):"undefined"!=typeof t[a]&&i.push(t[a]);return i}for(var c=Object.keys(t),u=0;u<c.length;++u){var s=c[u];t[s]=e.compact(t[s],n)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null!==t&&"undefined"!=typeof t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}}),P=c(E),L=E.isBuffer,S=E.isRegExp,R=E.compact,C=E.encode,T=E.decode,D=E.merge,F=E.arrayToObject,H=Object.freeze({default:P,isBuffer:L,isRegExp:S,compact:R,encode:C,decode:T,merge:D,arrayToObject:F}),U=u(function(t){var e=c(H),r={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},n={delimiter:"&",strictNullHandling:!1,skipNulls:!1,encode:!0,encoder:e.encode},o=function t(r,n,o,i,a,c,u,s,l){var p=r;if("function"==typeof u)p=u(n,p);else if(p instanceof Date)p=p.toISOString();else if(null===p){if(i)return c?c(n):n;p=""}if("string"==typeof p||"number"==typeof p||"boolean"==typeof p||e.isBuffer(p))return c?[c(n)+"="+c(p)]:[n+"="+String(p)];var f=[];if("undefined"==typeof p)return f;var d;if(Array.isArray(u))d=u;else{var h=Object.keys(p);d=s?h.sort(s):h}for(var y=0;y<d.length;++y){var v=d[y];a&&null===p[v]||(f=Array.isArray(p)?f.concat(t(p[v],o(n,v),o,i,a,c,u,s,l)):f.concat(t(p[v],n+(l?"."+v:"["+v+"]"),o,i,a,c,u,s,l)))}return f};t.exports=function(t,e){var i,a,c=t,u=e||{},s="undefined"==typeof u.delimiter?n.delimiter:u.delimiter,l="boolean"==typeof u.strictNullHandling?u.strictNullHandling:n.strictNullHandling,p="boolean"==typeof u.skipNulls?u.skipNulls:n.skipNulls,f="boolean"==typeof u.encode?u.encode:n.encode,d=f?"function"==typeof u.encoder?u.encoder:n.encoder:null,h="function"==typeof u.sort?u.sort:null,y="undefined"!=typeof u.allowDots&&u.allowDots;if(null!==u.encoder&&void 0!==u.encoder&&"function"!=typeof u.encoder)throw new TypeError("Encoder has to be a function.");"function"==typeof u.filter?(a=u.filter,c=a("",c)):Array.isArray(u.filter)&&(i=a=u.filter);var v=[];if("object"!=typeof c||null===c)return"";var g;g=u.arrayFormat in r?u.arrayFormat:"indices"in u?u.indices?"indices":"repeat":"indices";var m=r[g];i||(i=Object.keys(c)),h&&i.sort(h);for(var b=0;b<i.length;++b){var x=i[b];p&&null===c[x]||(v=v.concat(o(c[x],x,m,l,p,d,a,h,y)))}return v.join(s)}}),$=c(U),K=Object.freeze({default:$}),B=u(function(t){var e=c(H),r=Object.prototype.hasOwnProperty,n={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,decoder:e.decode},o=function(t,e){for(var n={},o=t.split(e.delimiter,e.parameterLimit===1/0?void 0:e.parameterLimit),i=0;i<o.length;++i){var a,c,u=o[i],s=u.indexOf("]=")===-1?u.indexOf("="):u.indexOf("]=")+1;s===-1?(a=e.decoder(u),c=e.strictNullHandling?null:""):(a=e.decoder(u.slice(0,s)),c=e.decoder(u.slice(s+1))),r.call(n,a)?n[a]=[].concat(n[a]).concat(c):n[a]=c}return n},i=function t(e,r,n){if(!e.length)return r;var o,i=e.shift();if("[]"===i)o=[],o=o.concat(t(e,r,n));else{o=n.plainObjects?Object.create(null):{};var a="["===i[0]&&"]"===i[i.length-1]?i.slice(1,i.length-1):i,c=parseInt(a,10);!isNaN(c)&&i!==a&&String(c)===a&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(o=[],o[c]=t(e,r,n)):o[a]=t(e,r,n)}return o},a=function(t,e,n){if(t){var o=n.allowDots?t.replace(/\.([^\.\[]+)/g,"[$1]"):t,a=/^([^\[\]]*)/,c=/(\[[^\[\]]*\])/g,u=a.exec(o),s=[];if(u[1]){if(!n.plainObjects&&r.call(Object.prototype,u[1])&&!n.allowPrototypes)return;s.push(u[1])}for(var l=0;null!==(u=c.exec(o))&&l<n.depth;)l+=1,(n.plainObjects||!r.call(Object.prototype,u[1].replace(/\[|\]/g,""))||n.allowPrototypes)&&s.push(u[1]);return u&&s.push("["+o.slice(u.index)+"]"),i(s,e,n)}};t.exports=function(t,r){var i=r||{};if(null!==i.decoder&&void 0!==i.decoder&&"function"!=typeof i.decoder)throw new TypeError("Decoder has to be a function.");if(i.delimiter="string"==typeof i.delimiter||e.isRegExp(i.delimiter)?i.delimiter:n.delimiter,i.depth="number"==typeof i.depth?i.depth:n.depth,i.arrayLimit="number"==typeof i.arrayLimit?i.arrayLimit:n.arrayLimit,i.parseArrays=i.parseArrays!==!1,i.decoder="function"==typeof i.decoder?i.decoder:n.decoder,i.allowDots="boolean"==typeof i.allowDots?i.allowDots:n.allowDots,i.plainObjects="boolean"==typeof i.plainObjects?i.plainObjects:n.plainObjects,i.allowPrototypes="boolean"==typeof i.allowPrototypes?i.allowPrototypes:n.allowPrototypes,i.parameterLimit="number"==typeof i.parameterLimit?i.parameterLimit:n.parameterLimit,i.strictNullHandling="boolean"==typeof i.strictNullHandling?i.strictNullHandling:n.strictNullHandling,""===t||null===t||"undefined"==typeof t)return i.plainObjects?Object.create(null):{};for(var c="string"==typeof t?o(t,i):t,u=i.plainObjects?Object.create(null):{},s=Object.keys(c),l=0;l<s.length;++l){var p=s[l],f=a(p,c[p],i);u=e.merge(u,f,i)}return e.compact(u)}}),I=c(B),z=Object.freeze({default:I}),q=u(function(t){var e=c(K),r=c(z);t.exports={stringify:e,parse:r}});c(q);var J=q.stringify,M=q.parse,_=k,V=function(){function t(t,r,n){var o=this;void 0===r&&(r=""),void 0===n&&(n={}),this.route=r+t.getAttribute("route"),this.component=e.components.getComponentNameForNode(t),this.action=s;var i=t.getAttribute("action");i&&(n.hasOwnProperty(i)?this.action=n[i]:e.components.defaultLoader.getConfig(this.component,function(t){t.hasOwnProperty(i)&&(o.action=t[i])})),this.re=_(this.route),this.keys=this.re.keys.map(function(t){return t.name})}return t.prototype.dispatch=function(t){var e=t.split("?"),r=e[0],n=e[1],o=this.re.exec(r);if(!o)return!1;for(var i={},a=1;a<o.length;++a)i[this.keys[a-1]]=o[a];return b(i,M(n)),this.context={params:i,state:null,route:this.route,url:o[0]},!0},t}();e.bindingHandlers.path=e.bindingHandlers.query=e.bindingHandlers.activePathCss={init:function(t,e,r,n,o){f.call(this,t,r,o)}};var W=e.observable(location.pathname),G="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",Q=[],X=function(t){function i(r,i,a){var c=this,u=a.rootUrl,s=a.routePrefix,l=a.actions,p=a.onNavStart,f=a.onNavFinish;t.call(this),this.route=null,this.routes=[],this.binding=e.observable(),Q.push(this),1===Q.length&&(addEventListener(G,y,!1),addEventListener("popstate",h,!1)),u=u||r.getAttribute("rootUrl"),s=s||r.getAttribute("routePrefix");var d=e.contextFor(r),g=n(d);if(g){if("string"==typeof u)throw new Error("Only top-level router can specify 'rootUrl'");this.routePrefix=g.routePrefix+(s||""),this.actions=l||g.actions}else this.rootUrl=u||"",this.routePrefix=u+s||"",this.actions=l||{};this.onNavStart=p||v,this.onNavFinish=f||v,this.routes=i.map(function(t){return new V(t,c.routePrefix,c.actions)}),this.dispatchAndNavigate(o(location))}return r(i,t),i.prototype.dispose=function(){Q.splice(Q.indexOf(this),1),0===Q.length&&(removeEventListener(G,y,!1),removeEventListener("popstate",h,!1))},i.prototype.dispatch=function(t){if(this.onNavStart(),this.route=g(this.routes,function(e){return e.dispatch(t)}),this.route){var e=this.binding(),r=this.route,n=r.component,o=r.context,i=r.action;return e&&e.component===n&&(o.state=e.params.state()),i(o)}},i.prototype.navigate=function(){if(!this.route)return this.binding(null),void this.onNavFinish();var t=this.route,e=t.component,r=t.context,n=this.binding();n&&n.component===e?n.params.update(r):this.binding({component:e,params:new w(r)}),this.route=null,this.onNavFinish()},i.prototype.dispatchAndNavigate=function(t){var e=this,r=this.dispatch(o(location));r?r.then(function(){e.navigate()}):this.navigate()},i}(x);e.components.register("knockout-router",{synchronous:!0,viewModel:{createViewModel:function(t,e){var r=e.element,n=e.templateNodes;return new X(r,n.filter(function(t){return 1===t.nodeType}),t)}},template:'\n        <div data-bind="if: binding()">\n            <div data-bind="component: {\n                name: binding().component,\n                params: binding().params\n            }"></div>\n        </div>\n    '.replace(/\s+/g," ")}),t.navigate=d,Object.defineProperty(t,"__esModule",{value:!0})});