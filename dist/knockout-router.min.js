!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("knockout")):"function"==typeof define&&define.amd?define(["exports","knockout"],e):e(t.KnockoutRouter=t.KnockoutRouter||{},t.ko)}(this,function(t,e){"use strict";function r(t,e){for(var r=0,n=t.length;r<n;){var o=t[r++];if(e(o))return o}}function n(t){var e=t.pathname,r=t.search,n=t.hash;return e+r+(n||"")}function o(t){return t=t||window.event,null===t.which?t.button:t.which}function i(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t&&0===t.indexOf(e)}function a(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function c(t,e){return e={exports:{}},t(e,e.exports),e.exports}function u(){}function s(t){t=t.split("#")[0].split("?")[0],J(t)}function l(t,r,n){return void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=null),(r.startsWith("~/")?t+r.substr(1):r)+(n?"?"+B(e.toJS(n)):"")}function p(t,n,i){var a=e.contextFor(t).$parents,c=r(a,function(t){return t&&t.rootUrl}),u=c&&c.rootUrl,s=e.pureComputed(function(){return l(u,n.get("path"),n.get("query"))}),p={};"A"===t.tagName.toLocaleUpperCase()?p.attr={href:s}:p.click=function(e,r){var n=1!==o(r),i=t.hasAttribute("target"),a="external"===t.getAttribute("rel"),c=r.metaKey||r.ctrlKey||r.shiftKey;if(n||i||a||c)return!0;var u=d(s());return u&&(r.preventDefault(),r.stopImmediatePropagation()),!u};var f=n.get("activePathCss");f&&(p.css=(h={},h[f]=e.pureComputed(function(){return s()===J()}),h)),e.tasks.schedule(function(){return e.applyBindingsToNode(t,p,i)});var h}function f(t){var n=e.contextFor(t).$parents;return r(n,function(t){return t instanceof V})}function d(t,e){void 0===e&&(e=!1);var n=_.map(function(e){return e.dispatch(t)}).filter(function(t){return!!t}),o=!!r(_,function(t){return!!t.route});o&&"undefined"!=typeof history&&(e?history.replaceState(null,null,t):history.pushState(null,null,t));var i=function(){_.forEach(function(t){t.navigate()}),o&&s(t)};return 0==n.length?i():Promise.all(n).then(i),o}function h(t){t.defaultPrevented||d(n(location),!0)&&t.preventDefault()}function y(t){for(var e=t.target;e&&"A"!==e.nodeName;)e=e.parentNode;if(e&&"A"===e.nodeName){var r=1!==o(t),a=t.metaKey||t.ctrlKey||t.shiftKey,c=e.hasAttribute("download"),u=e.hasAttribute("target"),s="external"===e.getAttribute("rel"),l=~(e.getAttribute("href")||"").indexOf("mailto:"),p=!i(e.href),f="#"===e.getAttribute("href");p||r||c||f||l||s||a||u||d(n(e))&&t.preventDefault()}}function v(){}var g=function(){function t(t){this.params={},this.state=e.observable(),this.route=e.observable(),this.url=e.observable(),this.update(t)}return t.prototype.update=function(t){var r=t.params,n=t.state,o=t.route,i=t.url;for(var a in r)if(r.hasOwnProperty(a)){var c=r[a],u=this.params[a];u?u(c):this.params[a]=e.observable(c)}for(var a in this.params)this.params.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&this.params[a](null);this.state(n),this.route(o),this.url(i)},t}(),m=c(function(t){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}}),b=a(m),x=Object.freeze({default:b}),w=c(function(t){function e(t){for(var e,r=[],n=0,o=0,i="";null!=(e=g.exec(t));){var a=e[0],c=e[1],s=e.index;if(i+=t.slice(o,s),o=s+a.length,c)i+=c[1];else{var l=t[o],p=e[2],f=e[3],d=e[4],h=e[5],y=e[6],v=e[7];i&&(r.push(i),i="");var m=null!=p&&null!=l&&l!==p,b="+"===y||"*"===y,x="?"===y||"*"===y,w=e[2]||"/",O=d||h||(v?".*":"[^"+w+"]+?");r.push({name:f||n++,prefix:p||"",delimiter:w,optional:x,repeat:b,partial:m,asterisk:!!v,pattern:u(O)})}}return o<t.length&&(i+=t.substr(o)),i&&r.push(i),r}function r(t){return i(e(t))}function n(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function o(t){return encodeURI(t).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function i(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,i){for(var a="",c=r||{},u=i||{},s=u.pretty?n:encodeURIComponent,l=0;l<t.length;l++){var p=t[l];if("string"!=typeof p){var f,d=c[p.name];if(null==d){if(p.optional){p.partial&&(a+=p.prefix);continue}throw new TypeError('Expected "'+p.name+'" to be defined')}if(v(d)){if(!p.repeat)throw new TypeError('Expected "'+p.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(p.optional)continue;throw new TypeError('Expected "'+p.name+'" to not be empty')}for(var h=0;h<d.length;h++){if(f=s(d[h]),!e[l].test(f))throw new TypeError('Expected all "'+p.name+'" to match "'+p.pattern+'", but received `'+JSON.stringify(f)+"`");a+=(0===h?p.prefix:p.delimiter)+f}}else{if(f=p.asterisk?o(d):s(d),!e[l].test(f))throw new TypeError('Expected "'+p.name+'" to match "'+p.pattern+'", but received "'+f+'"');a+=p.prefix+f}}else a+=p}return a}}function c(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function u(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function s(t,e){return t.keys=e,t}function l(t){return t.sensitive?"":"i"}function p(t,e){var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return s(t,e)}function f(t,e,r){for(var n=[],o=0;o<t.length;o++)n.push(y(t[o],e,r).source);var i=new RegExp("(?:"+n.join("|")+")",l(r));return s(i,e)}function d(t,r,n){for(var o=e(t),i=h(o,n),a=0;a<o.length;a++)"string"!=typeof o[a]&&r.push(o[a]);return s(i,r)}function h(t,e){e=e||{};for(var r=e.strict,n=e.end!==!1,o="",i=t[t.length-1],a="string"==typeof i&&/\/$/.test(i),u=0;u<t.length;u++){var s=t[u];if("string"==typeof s)o+=c(s);else{var p=c(s.prefix),f="(?:"+s.pattern+")";s.repeat&&(f+="(?:"+p+f+")*"),f=s.optional?s.partial?p+"("+f+")?":"(?:"+p+"("+f+"))?":p+"("+f+")",o+=f}}return r||(o=(a?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=n?"$":r&&a?"":"(?=\\/|$)",new RegExp("^"+o,l(e))}function y(t,e,r){return e=e||[],v(e)?r||(r={}):(r=e,e=[]),t instanceof RegExp?p(t,e):v(t)?f(t,e,r):d(t,e,r)}var v=a(x);t.exports=y,t.exports.parse=e,t.exports.compile=r,t.exports.tokensToFunction=i,t.exports.tokensToRegExp=h;var g=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")}),O=a(w),j=c(function(t,e){var r=function(){for(var t=new Array(256),e=0;e<256;++e)t[e]="%"+((e<16?"0":"")+e.toString(16)).toUpperCase();return t}();e.arrayToObject=function(t,e){for(var r=e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)"undefined"!=typeof t[n]&&(r[n]=t[n]);return r},e.merge=function(t,r,n){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];t[r]=!0}return t}if("object"!=typeof t)return[t].concat(r);var o=t;return Array.isArray(t)&&!Array.isArray(r)&&(o=e.arrayToObject(t,n)),Object.keys(r).reduce(function(t,o){var i=r[o];return Object.prototype.hasOwnProperty.call(t,o)?t[o]=e.merge(t[o],i,n):t[o]=i,t},o)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),n="",o=0;o<e.length;++o){var i=e.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?n+=e.charAt(o):i<128?n+=r[i]:i<2048?n+=r[192|i>>6]+r[128|63&i]:i<55296||i>=57344?n+=r[224|i>>12]+r[128|i>>6&63]+r[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(o)),n+=r[240|i>>18]+r[128|i>>12&63]+r[128|i>>6&63]+r[128|63&i])}return n},e.compact=function(t,r){if("object"!=typeof t||null===t)return t;var n=r||[],o=n.indexOf(t);if(o!==-1)return n[o];if(n.push(t),Array.isArray(t)){for(var i=[],a=0;a<t.length;++a)t[a]&&"object"==typeof t[a]?i.push(e.compact(t[a],n)):"undefined"!=typeof t[a]&&i.push(t[a]);return i}for(var c=Object.keys(t),u=0;u<c.length;++u){var s=c[u];t[s]=e.compact(t[s],n)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null!==t&&"undefined"!=typeof t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}}),A=a(j),k=j.isBuffer,N=j.isRegExp,E=j.compact,P=j.encode,L=j.decode,S=j.merge,R=j.arrayToObject,C=Object.freeze({default:A,isBuffer:k,isRegExp:N,compact:E,encode:P,decode:L,merge:S,arrayToObject:R}),T=c(function(t){var e=a(C),r={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},n={delimiter:"&",strictNullHandling:!1,skipNulls:!1,encode:!0,encoder:e.encode},o=function t(r,n,o,i,a,c,u,s,l){var p=r;if("function"==typeof u)p=u(n,p);else if(p instanceof Date)p=p.toISOString();else if(null===p){if(i)return c?c(n):n;p=""}if("string"==typeof p||"number"==typeof p||"boolean"==typeof p||e.isBuffer(p))return c?[c(n)+"="+c(p)]:[n+"="+String(p)];var f=[];if("undefined"==typeof p)return f;var d;if(Array.isArray(u))d=u;else{var h=Object.keys(p);d=s?h.sort(s):h}for(var y=0;y<d.length;++y){var v=d[y];a&&null===p[v]||(f=Array.isArray(p)?f.concat(t(p[v],o(n,v),o,i,a,c,u,s,l)):f.concat(t(p[v],n+(l?"."+v:"["+v+"]"),o,i,a,c,u,s,l)))}return f};t.exports=function(t,e){var i,a,c=t,u=e||{},s="undefined"==typeof u.delimiter?n.delimiter:u.delimiter,l="boolean"==typeof u.strictNullHandling?u.strictNullHandling:n.strictNullHandling,p="boolean"==typeof u.skipNulls?u.skipNulls:n.skipNulls,f="boolean"==typeof u.encode?u.encode:n.encode,d=f?"function"==typeof u.encoder?u.encoder:n.encoder:null,h="function"==typeof u.sort?u.sort:null,y="undefined"!=typeof u.allowDots&&u.allowDots;if(null!==u.encoder&&void 0!==u.encoder&&"function"!=typeof u.encoder)throw new TypeError("Encoder has to be a function.");"function"==typeof u.filter?(a=u.filter,c=a("",c)):Array.isArray(u.filter)&&(i=a=u.filter);var v=[];if("object"!=typeof c||null===c)return"";var g;g=u.arrayFormat in r?u.arrayFormat:"indices"in u?u.indices?"indices":"repeat":"indices";var m=r[g];i||(i=Object.keys(c)),h&&i.sort(h);for(var b=0;b<i.length;++b){var x=i[b];p&&null===c[x]||(v=v.concat(o(c[x],x,m,l,p,d,a,h,y)))}return v.join(s)}}),U=a(T),D=Object.freeze({default:U}),H=c(function(t){var e=a(C),r=Object.prototype.hasOwnProperty,n={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,decoder:e.decode},o=function(t,e){for(var n={},o=t.split(e.delimiter,e.parameterLimit===1/0?void 0:e.parameterLimit),i=0;i<o.length;++i){var a,c,u=o[i],s=u.indexOf("]=")===-1?u.indexOf("="):u.indexOf("]=")+1;s===-1?(a=e.decoder(u),c=e.strictNullHandling?null:""):(a=e.decoder(u.slice(0,s)),c=e.decoder(u.slice(s+1))),r.call(n,a)?n[a]=[].concat(n[a]).concat(c):n[a]=c}return n},i=function t(e,r,n){if(!e.length)return r;var o,i=e.shift();if("[]"===i)o=[],o=o.concat(t(e,r,n));else{o=n.plainObjects?Object.create(null):{};var a="["===i[0]&&"]"===i[i.length-1]?i.slice(1,i.length-1):i,c=parseInt(a,10);!isNaN(c)&&i!==a&&String(c)===a&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(o=[],o[c]=t(e,r,n)):o[a]=t(e,r,n)}return o},c=function(t,e,n){if(t){var o=n.allowDots?t.replace(/\.([^\.\[]+)/g,"[$1]"):t,a=/^([^\[\]]*)/,c=/(\[[^\[\]]*\])/g,u=a.exec(o),s=[];if(u[1]){if(!n.plainObjects&&r.call(Object.prototype,u[1])&&!n.allowPrototypes)return;s.push(u[1])}for(var l=0;null!==(u=c.exec(o))&&l<n.depth;)l+=1,(n.plainObjects||!r.call(Object.prototype,u[1].replace(/\[|\]/g,""))||n.allowPrototypes)&&s.push(u[1]);return u&&s.push("["+o.slice(u.index)+"]"),i(s,e,n)}};t.exports=function(t,r){var i=r||{};if(null!==i.decoder&&void 0!==i.decoder&&"function"!=typeof i.decoder)throw new TypeError("Decoder has to be a function.");if(i.delimiter="string"==typeof i.delimiter||e.isRegExp(i.delimiter)?i.delimiter:n.delimiter,i.depth="number"==typeof i.depth?i.depth:n.depth,i.arrayLimit="number"==typeof i.arrayLimit?i.arrayLimit:n.arrayLimit,i.parseArrays=i.parseArrays!==!1,i.decoder="function"==typeof i.decoder?i.decoder:n.decoder,i.allowDots="boolean"==typeof i.allowDots?i.allowDots:n.allowDots,i.plainObjects="boolean"==typeof i.plainObjects?i.plainObjects:n.plainObjects,i.allowPrototypes="boolean"==typeof i.allowPrototypes?i.allowPrototypes:n.allowPrototypes,i.parameterLimit="number"==typeof i.parameterLimit?i.parameterLimit:n.parameterLimit,i.strictNullHandling="boolean"==typeof i.strictNullHandling?i.strictNullHandling:n.strictNullHandling,""===t||null===t||"undefined"==typeof t)return i.plainObjects?Object.create(null):{};for(var a="string"==typeof t?o(t,i):t,u=i.plainObjects?Object.create(null):{},s=Object.keys(a),l=0;l<s.length;++l){var p=s[l],f=c(p,a[p],i);u=e.merge(u,f,i)}return e.compact(u)}}),$=a(H),F=Object.freeze({default:$}),K=c(function(t){var e=a(D),r=a(F);t.exports={stringify:e,parse:r}});a(K);var B=K.stringify,I=K.parse,z=O,q=function(){function t(t,r,n){var o=this;void 0===r&&(r=""),void 0===n&&(n={}),this.route=r+t.getAttribute("route"),this.component=e.components.getComponentNameForNode(t),this.action=u;var i=t.getAttribute("action");i&&(n.hasOwnProperty(i)?this.action=n[i]:e.components.defaultLoader.getConfig(this.component,function(t){t.hasOwnProperty(i)&&(o.action=t[i])})),this.re=z(this.route),this.keys=this.re.keys.map(function(t){return t.name})}return t.prototype.dispatch=function(t){var e=t.split("?"),r=e[0],n=e[1],o=this.re.exec(r);if(!o)return!1;for(var i={},a=1;a<o.length;++a)i[this.keys[a-1]]=o[a];var c=I(n);for(var u in c)c.hasOwnProperty(u)&&(i[u]=c[u]);return this.context={params:i,state:null,route:this.route,url:o[0]},!0},t}();e.bindingHandlers.path=e.bindingHandlers.query=e.bindingHandlers.activePathCss={init:function(t,e,r,n,o){p.call(this,t,r,o)}};var J=e.observable(location.pathname),M="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",_=[],V=function(){function t(t,r,o){var i=this,a=o.rootUrl,c=o.routePrefix,u=o.actions,s=o.onNavStart,l=o.onNavFinish;this.route=null,this.routes=[],this.binding=e.observable(),_.push(this),1===_.length&&(addEventListener(M,y,!1),addEventListener("popstate",h,!1)),a=a||t.getAttribute("rootUrl"),c=c||t.getAttribute("routePrefix");var p=f(t);if(p){if("string"==typeof a)throw new Error("Only top-level router can specify 'rootUrl'");this.routePrefix=p.routePrefix+(c||""),this.actions=u||p.actions}else this.rootUrl=a||"",this.routePrefix=a+c||"",this.actions=u||{};this.onNavStart=s||v,this.onNavFinish=l||v,this.routes=r.map(function(t){return new q(t,i.routePrefix,i.actions)}),this.dispatchAndNavigate(n(location))}return t.prototype.dispose=function(){_.splice(_.indexOf(this),1),0===_.length&&(removeEventListener(M,y,!1),removeEventListener("popstate",h,!1))},t.prototype.dispatch=function(t){if(this.onNavStart(),this.route=r(this.routes,function(e){return e.dispatch(t)}),this.route){var e=this.binding(),n=this.route,o=n.component,i=n.context,a=n.action;return e&&e.component===o&&(i.state=e.params.state()),a(i)}},t.prototype.navigate=function(){if(!this.route)return this.binding(null),void this.onNavFinish();var t=this.route,e=t.component,r=t.context,n=this.binding();n&&n.component===e?n.params.update(r):this.binding({component:e,params:new g(r)}),this.route=null,this.onNavFinish()},t.prototype.dispatchAndNavigate=function(t){var e=this,r=this.dispatch(n(location));r?r.then(function(){e.navigate()}):this.navigate()},t}();e.components.register("knockout-router",{synchronous:!0,viewModel:{createViewModel:function(t,e){var r=e.element,n=e.templateNodes;return new V(r,n.filter(function(t){return 1===t.nodeType}),t)}},template:"\n        <!-- ko if: binding() -->\n            <!-- ko component: {\n                name: binding().component,\n                params: binding().params\n            } --><!-- /ko -->\n        <!-- /ko -->\n    ".replace(/\s+/g," ")}),t.navigate=d,Object.defineProperty(t,"__esModule",{value:!0})});